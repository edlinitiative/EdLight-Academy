"use strict";(self.webpackChunkedlight_academy=self.webpackChunkedlight_academy||[]).push([[889],{2889:(e,t,s)=>{s.r(t),s.d(t,{default:()=>_});var o=s(4705),n=s(6540),a=s(4867);function r(e,t){const s=t.join(","),o=(e||[]).map(e=>t.map(t=>(e=>{const t=null==e?"":String(e);return/[",\n\r]/.test(t)?'"'+t.replace(/"/g,'""')+'"':t})(e[t])).join(",")).join("\n");return s+"\n"+o+(o?"\n":"")}function c(e){return String(e||"").trim().toLowerCase().replace(/[\s\-]+/g,"_")}function l(e,t){const s=new Map(Object.keys(e).map(e=>[c(e),e])),o={};for(const n of t){const t=c(n),a=s.get(t);o[n]=null!=a?e[a]:""}return o}var i=s(7016),d=s(4589),u=s(4848);function m(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,o)}return s}function p(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?m(Object(s),!0).forEach(function(t){(0,o.A)(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}const h=["id","subject_code","unit_no","unit_title","lesson_no","video_title","learning_objectives","language","duration_min","video_url","thumbnail_url","tags"],g=["id","subject_code","subject","level","unit","Chapter_Number","video_title","Subchapter_Number","question_type","question","options","correct_answer","hint","good_response","wrong_response","language","difficulty","tags","source_doc","created_at"],f=["user_id","name","email","role","enrolled_courses","created_at","last_seen"];let b;function y(){return b||(b=s.e(959).then(s.bind(s,3959))),b}function x(e){let{onData:t,columns:o,label:a}=e;const[r,c]=(0,n.useState)("");return(0,u.jsxs)("div",{children:[(0,u.jsxs)("label",{className:"button button--secondary button--pill",style:{cursor:"pointer"},children:[a,(0,u.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",style:{display:"none"},onChange:e=>async function(e){c("");const n=null==e?void 0:e[0];if(n)try{if(n.name.endsWith(".csv")){const e=await n.text(),a=await async function(e){return(await Promise.resolve().then(s.bind(s,4867))).parseCSV(e)}(e);console.log("[Admin] Parsed CSV rows:",a.length,"Sample:",a[0]);const r=a.map(e=>l(e,o));console.log("[Admin] Mapped to columns:",o),console.log("[Admin] Sample mapped row:",r[0]),t(r,{sourceName:n.name,type:"csv"})}else if(n.name.endsWith(".xlsx")||n.name.endsWith(".xls")){const e=new Uint8Array(await n.arrayBuffer()),s=(await y()).default||await y(),a=s.read(e,{type:"array"}),r=a.Sheets[a.SheetNames[0]],c=s.utils.sheet_to_json(r,{defval:""}).map(e=>l(e,o));t(c,{sourceName:n.name,type:"xlsx"})}else c("Unsupported file type. Please upload a .csv or .xlsx file.")}catch(e){console.error(e),c(e.message||"Failed to parse file")}}(e.target.files)})]}),r&&(0,u.jsx)("div",{className:"form-message form-message--error",style:{marginTop:"0.5rem"},children:r})]})}function j(e){let{rows:t,columns:s,onEdit:o}=e;return null!=t&&t.length?(0,u.jsx)("div",{style:{overflowX:"auto"},children:(0,u.jsxs)("table",{className:"table",style:{width:"100%",borderCollapse:"collapse"},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[s.map(e=>(0,u.jsx)("th",{style:{textAlign:"left",padding:"8px",borderBottom:"1px solid #e5e7eb"},children:e},e)),(0,u.jsx)("th",{style:{padding:"8px"},children:"Actions"})]})}),(0,u.jsx)("tbody",{children:t.map((e,n)=>(0,u.jsxs)("tr",{children:[s.map(t=>(0,u.jsx)("td",{style:{padding:"8px",borderBottom:"1px solid #f1f5f9",whiteSpace:"nowrap",maxWidth:360,overflow:"hidden",textOverflow:"ellipsis"},children:e[t]},t)),(0,u.jsx)("td",{style:{padding:"8px"},children:(0,u.jsx)("button",{className:"button button--ghost button--pill",onClick:()=>(e=>{console.log("Edit clicked for index:",e,"Row:",t[e]),o(e)})(n),children:"Edit"})})]},n))})]})}):null}function v(e){let{row:t,columns:s,onSave:o,onCancel:a}=e;const[r,c]=(0,n.useState)(()=>{const e={};return s.forEach(s=>{const o=null==t?void 0:t[s];e[s]=null==o?"":"object"==typeof o?JSON.stringify(o):String(o)}),e}),l=["question","learning_objectives","options","hint","good_response","wrong_response","tags"],i=["video_url","thumbnail_url","question","options","learning_objectives","email"];return(0,u.jsx)("div",{className:"modal modal--active",onClick:a,children:(0,u.jsxs)("div",{className:"modal__content",onClick:e=>e.stopPropagation(),style:{maxWidth:"1000px",maxHeight:"90vh",width:"95vw",display:"flex",flexDirection:"column"},children:[(0,u.jsxs)("div",{className:"modal__header",style:{borderBottom:"1px solid var(--color-border)",padding:"1.5rem",flexShrink:0},children:[(0,u.jsx)("h3",{className:"modal__title",style:{fontSize:"1.5rem",margin:0},children:"Edit Course Details"}),(0,u.jsx)("button",{className:"modal__close",onClick:a,"aria-label":"Close",children:"Ã—"})]}),(0,u.jsx)("div",{className:"modal__body",style:{flex:1,overflow:"auto",padding:"1.5rem"},children:(0,u.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem",alignItems:"start"},children:s.map(e=>{var t;const s=null!==(t=r[e])&&void 0!==t?t:"",o=l.includes(e),n=i.includes(e),a="id"===e||"user_id"===e||"created_at"===e;return(0,u.jsxs)("div",{className:"form-field",style:n?{gridColumn:"1 / -1"}:{},children:[(0,u.jsxs)("label",{className:"form-label",style:{fontWeight:500,marginBottom:"0.5rem",display:"block",color:"var(--color-text)",fontSize:"0.875rem"},children:[e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),a&&(0,u.jsx)("span",{style:{color:"var(--color-text-muted)",marginLeft:"0.5rem"},children:"(read-only)"})]}),o?(0,u.jsx)("textarea",{className:"form-input",value:s,onChange:t=>c(p(p({},r),{},{[e]:t.target.value})),rows:4,disabled:a,style:{resize:"vertical",minHeight:"80px",fontFamily:"inherit"}}):(0,u.jsx)("input",{className:"form-input",value:s,onChange:t=>c(p(p({},r),{},{[e]:t.target.value})),disabled:a,style:a?{backgroundColor:"var(--color-bg-tertiary)",cursor:"not-allowed",opacity:.7}:{}})]},e)})})}),(0,u.jsxs)("div",{className:"modal__footer",style:{borderTop:"1px solid var(--color-border)",padding:"1.5rem",display:"flex",justifyContent:"flex-end",gap:"1rem",flexShrink:0,backgroundColor:"var(--color-bg-secondary)"},children:[(0,u.jsx)("button",{className:"button button--ghost button--pill",onClick:a,children:"Cancel"}),(0,u.jsx)("button",{className:"button button--primary button--pill",onClick:()=>o(r),children:"Save Changes"})]})]})})}function w(e){let{title:t,columns:s,sourceUrl:o,idKey:c,collectionType:m}=e;const[h,g]=(0,n.useState)([]),[f,b]=(0,n.useState)(""),[y,w]=(0,n.useState)("replace"),[_,N]=(0,n.useState)(null),[S,z]=(0,n.useState)(!1),[C,k]=(0,n.useState)(null),O=h&&h.length>0;function q(e){if(!e||"object"!=typeof e)return e;const t=p({},e);for(const e in t){const s=t[e];s&&"object"==typeof s&&"seconds"in s&&"nanoseconds"in s?t[e]=new Date(1e3*s.seconds).toISOString():Array.isArray(s)&&(t[e]=s.map(e=>e&&"object"==typeof e&&"seconds"in e?new Date(1e3*e.seconds).toISOString():e))}return t}return(0,u.jsx)("section",{className:"section",style:{paddingTop:"1.5rem"},children:(0,u.jsxs)("div",{className:"container",children:[(0,u.jsxs)("div",{className:"page-header",style:{marginBottom:"1rem"},children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"page-header__eyebrow",children:"Admin"}),(0,u.jsx)("h2",{children:t}),(0,u.jsxs)("p",{className:"text-muted",children:["Columns: ",s.join(", ")]})]}),(0,u.jsxs)("div",{className:"page-header__actions",style:{alignItems:"center"},children:[(0,u.jsx)("div",{className:"chip",children:"Mode:"}),(0,u.jsxs)("label",{className:"chip",style:{cursor:"pointer"},children:[(0,u.jsx)("input",{type:"radio",name:"".concat(t,"-mode"),checked:"replace"===y,onChange:()=>w("replace")})," Replace"]}),(0,u.jsxs)("label",{className:"chip",style:{cursor:"pointer"},children:[(0,u.jsx)("input",{type:"radio",name:"".concat(t,"-mode"),checked:"merge"===y,onChange:()=>w("merge")})," Merge"]}),(0,u.jsx)(x,{onData:function(e,t){if("replace"!==y&&h.length){const t=new Map(h.map(e=>[e[c],e]));for(const s of e)t.set(s[c],p(p({},t.get(s[c])||{}),s));g(Array.from(t.values()))}else g(e);b((null==t?void 0:t.sourceName)||"Uploaded"),m&&(k({type:"info",message:"âœ… Loaded ".concat(e.length," items from ").concat((null==t?void 0:t.sourceName)||"file",'. Click "ðŸ’¾ Save to Firebase" to sync changes.')}),setTimeout(()=>k(null),8e3))},columns:s,label:"Upload ".concat(t)}),(0,u.jsx)("button",{className:"button button--ghost button--pill",onClick:async function(){try{if(k({type:"info",message:"Loading from Firebase..."}),g([]),"videos"===m){const e=(0,d.rJ)(i.db,"videos"),t=await(0,d.GG)(e),o=[];t.forEach(e=>{o.push(q(p({id:e.id},e.data())))}),console.log("Loaded ".concat(o.length," videos from Firebase"));const n=o.map(e=>l(e,s));g(n),b("Firebase (videos collection)"),k({type:"success",message:"âœ… Loaded ".concat(o.length," videos from Firebase")})}else if("quizzes"===m){const e=(0,d.rJ)(i.db,"quizzes"),t=await(0,d.GG)(e),o=[];t.forEach(e=>{o.push(q(p({id:e.id},e.data())))}),console.log("Loaded ".concat(o.length," quizzes from Firebase"),o.length>0?o[0]:"No data");const n=o.map(e=>l(e,s));g(n),b("Firebase (quizzes collection)"),k({type:"success",message:"âœ… Loaded ".concat(o.length," quizzes from Firebase")})}else if("users"===m){const e=(0,d.rJ)(i.db,"users"),t=await(0,d.GG)(e),o=[];t.forEach(e=>{o.push(q(p({user_id:e.id},e.data())))}),console.log("Loaded ".concat(o.length," users from Firebase"),o.length>0?o[0]:"No data");const n=o.map(e=>l(e,s));g(n),b("Firebase (users collection)"),k({type:"success",message:"âœ… Loaded ".concat(o.length," users from Firebase")})}else if(o){const e=(await(0,a.F)(o)).map(e=>l(e,s));g(e),b(o),k({type:"success",message:"âœ… Loaded from ".concat(o)})}else{const e=await async function(e){const t=await(0,d.GG)((0,d.rJ)(i.db,e)),s=[];return t.forEach(e=>{s.push(p({id:e.id},e.data()))}),s}(m),t=e.map(e=>l(e,s));g(t),b("Firestore (".concat(m," collection)")),k({type:"success",message:"âœ… Loaded ".concat(e.length," items from Firestore")})}setTimeout(()=>k(null),3e3)}catch(e){console.error("Error loading data:",e),k({type:"error",message:"âŒ Failed to load: ".concat(e.message)}),setTimeout(()=>k(null),5e3)}},children:"Load current"}),(0,u.jsx)("button",{className:"button button--secondary button--pill",onClick:function(){g([Object.fromEntries(s.map(e=>[e,""])),...h]),N(0)},children:"Add new"}),m&&(0,u.jsx)("button",{className:"button button--primary button--pill",onClick:async function(){z(!0),k({type:"info",message:"Syncing to Firebase..."});try{let e=0,t=0;const s=[];for(const o of h)try{const n=o[c];if(!n){console.warn("Skipping row without ID:",o),t++,s.push("Row missing ".concat(c));continue}const a=String(n).replace(/\//g,"_"),r=p(p({},o),{},{[c]:a});Object.keys(r).forEach(e=>{null==r[e]&&(r[e]="")}),"videos"===m?await(0,i.h5)(a,r):"quizzes"===m?await(0,i.pm)(a,r):"users"===m&&await(0,i.TK)(a,r),e++}catch(e){console.error("Error syncing ".concat(o[c],":"),e),t++,s.push("".concat(o[c],": ").concat(e.message))}0===t?k({type:"success",message:"âœ… Successfully synced ".concat(e," items to Firebase!")}):(console.error("Sync errors:",s),k({type:"warning",message:"âš ï¸ Synced ".concat(e," items. ").concat(t," failed. Check console for details.")}))}catch(e){console.error("Sync failed with error:",e),k({type:"error",message:"âŒ Sync failed: ".concat(e.message)})}finally{z(!1),setTimeout(()=>k(null),5e3)}},disabled:!O||S,children:S?"Syncing...":"ðŸ’¾ Save to Firebase"}),"quizzes"===m&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("button",{className:"button button--ghost button--pill",onClick:async()=>{try{z(!0),k({type:"info",message:"Checking quiz database..."});const e=(0,d.rJ)(i.db,"quizzes"),t=(await(0,d.GG)(e)).size;k({type:"info",message:"ðŸ“Š Dry Run: Found ".concat(t,' quizzes in database. Click "ðŸ§¹ Clear quiz database" to delete them (with automatic backup).')})}catch(e){console.error(e),k({type:"error",message:"âŒ Failed to check database: ".concat(e.message)})}finally{z(!1),setTimeout(()=>k(null),1e4)}},disabled:S,children:"ðŸ” Preview Quiz Count"}),(0,u.jsx)("button",{className:"button button--danger button--pill",onClick:async()=>{try{z(!0),k({type:"info",message:"Loading quizzes for backup..."});const e=(0,d.rJ)(i.db,"quizzes"),t=await(0,d.GG)(e),o=[];t.forEach(e=>{var t,s;const n=p({id:e.id},e.data());null!==(t=n.created_at)&&void 0!==t&&t.seconds&&(n.created_at=new Date(1e3*n.created_at.seconds).toISOString()),null!==(s=n.updated_at)&&void 0!==s&&s.seconds&&(n.updated_at=new Date(1e3*n.updated_at.seconds).toISOString()),o.push(n)});const n=o.length;if(0===n)return k({type:"info",message:"No quizzes to delete."}),z(!1),void setTimeout(()=>k(null),3e3);if(!window.confirm("This will:\n\n"+"1. Export ".concat(n," quizzes as backup CSV\n")+"2. Permanently delete ALL ".concat(n," quizzes from Firestore\n\n")+"Are you sure you want to continue?"))return z(!1),void k(null);k({type:"info",message:"ðŸ“¥ Creating backup of ".concat(n," quizzes...")});const a=(new Date).toISOString().replace(/[:.]/g,"-").substring(0,19),c="quizzes_backup_".concat(a,".csv"),u=r(o.map(e=>l(e,s)),s),m=new Blob([u],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(m),f=document.createElement("a");f.href=h,f.download=c,f.click(),URL.revokeObjectURL(h),await new Promise(e=>setTimeout(e,500)),k({type:"info",message:"ðŸ—‘ï¸ Deleting ".concat(n," quizzes...")});const b=await(0,i.EI)();g([]),k({type:"success",message:'âœ… Backup saved as "'.concat(c,'". Deleted ').concat(b.deleted||0," quizzes.")})}catch(e){console.error(e),k({type:"error",message:"âŒ Failed: ".concat(e.message)})}finally{z(!1),setTimeout(()=>k(null),8e3)}},disabled:S,children:"ðŸ§¹ Clear quiz database"})]}),(0,u.jsx)("button",{className:"button button--ghost button--pill",onClick:function(){const e=r(h,s),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="".concat(o.split("/").pop()||"export").replace(".csv",".updated.csv"),a.click(),URL.revokeObjectURL(n)},disabled:!O,children:"Download CSV"})]})]}),C&&(0,u.jsx)("div",{className:"form-message form-message--".concat("success"===C.type?"success":"error"===C.type?"error":"info"),style:{marginBottom:"1rem"},children:C.message}),O?(0,u.jsxs)("div",{className:"card",style:{padding:"1rem"},children:[(0,u.jsxs)("div",{className:"text-muted",style:{marginBottom:"0.5rem"},children:["Source: ",f||"â€”"," â€¢ ",h.length," rows"]}),(0,u.jsx)(j,{rows:h,columns:s,onEdit:e=>{console.log("Setting editIdx to:",e),N(e)}})]}):(0,u.jsx)("div",{className:"card card--compact",style:{padding:"1rem"},children:(0,u.jsxs)("p",{className:"text-muted",children:['No data loaded yet. Upload a file or click "Load current" to fetch ',o,"."]})}),null!==_&&(0,u.jsx)(v,{row:h[_],columns:s,onSave:function(e){const t=h.slice();t[_]=l(e,s),g(t),N(null)},onCancel:()=>N(null)},_)]})})}function _(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("section",{className:"section",style:{paddingTop:"2rem",paddingBottom:"1rem"},children:(0,u.jsxs)("div",{className:"container",children:[(0,u.jsx)("div",{className:"page-header",style:{marginBottom:"1.5rem"},children:(0,u.jsxs)("div",{children:[(0,u.jsx)("span",{className:"page-header__eyebrow",children:"Admin Dashboard"}),(0,u.jsx)("h1",{children:"Content Management"}),(0,u.jsx)("p",{className:"text-muted",children:"Manage videos, quizzes, users, and course structure"})]})}),(0,u.jsxs)("div",{className:"card",style:{marginBottom:"2rem"},children:[(0,u.jsx)("h3",{className:"card__title",style:{marginBottom:"1rem"},children:"Quick Actions"}),(0,u.jsxs)("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:[(0,u.jsx)("a",{href:"/admin/courses",className:"button button--primary button--pill",children:"ðŸ“š Manage Course Structure"}),(0,u.jsx)("a",{href:"/admin/verify",className:"button button--primary button--pill",children:"âœ… Verify Exam Answers"}),(0,u.jsx)("a",{href:"#courses",className:"button button--ghost button--pill",children:"ðŸŽ¬ Manage Videos"}),(0,u.jsx)("a",{href:"#quizzes",className:"button button--ghost button--pill",children:"ðŸ“ Manage Quizzes"}),(0,u.jsx)("a",{href:"#users",className:"button button--ghost button--pill",children:"ðŸ‘¥ Manage Users"})]})]})]})}),(0,u.jsx)(w,{title:"Courses (Videos CSV)",columns:h,sourceUrl:"/data/edlight_videos.csv",idKey:"id",collectionType:"videos"}),(0,u.jsx)(w,{title:"Quizzes",columns:g,sourceUrl:null,idKey:"id",collectionType:"quizzes"}),(0,u.jsx)(w,{title:"Users",columns:f,sourceUrl:"/api/users/export",idKey:"user_id",collectionType:"users"})]})}},4867:(e,t,s)=>{function o(e){const t=[];let s=0,o="",n=[],a=!1;for(;s<=e.length;){const r=e[s]||"\n";a?'"'===r?'"'===e[s+1]?(o+='"',s++):a=!1:o+=r:'"'===r?a=!0:","===r?(n.push(o),o=""):"\n"===r||"\r"===r?((o.length||n.length)&&(n.push(o),t.push(n.map(e=>e.trim()))),o="",n=[],"\r"===r&&"\n"===e[s+1]&&s++):o+=r,s++}const[r,...c]=t;return c.map(e=>Object.fromEntries(r.map((t,s)=>{var o;return[t,null!==(o=e[s])&&void 0!==o?o:""]})))}async function n(e){try{const t=await fetch(e);if(!t.ok)throw new Error("Failed to fetch ".concat(e,": ").concat(t.status," ").concat(t.statusText));return o(await t.text())}catch(t){throw console.error("Error loading CSV from ".concat(e,":"),t),t}}s.d(t,{F:()=>n,parseCSV:()=>o})}}]);