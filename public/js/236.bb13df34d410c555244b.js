"use strict";(self.webpackChunkedlight_academy=self.webpackChunkedlight_academy||[]).push([[236],{7791:(e,a,s)=>{s.d(a,{O4:()=>i,R3:()=>o,n7:()=>l,qZ:()=>c});var t=s(6540);const n="https://unpkg.com/katex@0.16.9/dist/katex.min.css",r="https://unpkg.com/katex@0.16.9/dist/katex.min.js";function l(){const[e,a]=(0,t.useState)("undefined"!=typeof window&&!!window.katex);return(0,t.useEffect)(()=>{e||(function(e){if(document.querySelector('link[href="'.concat(e,'"]')))return;const a=document.createElement("link");a.rel="stylesheet",a.href=e,document.head.appendChild(a)}(n),function(e,a){if(document.querySelector('script[src="'.concat(e,'"]')))return void(a&&a());const s=document.createElement("script");s.src=e,s.async=!0,s.onload=a||null,document.body.appendChild(s)}(r,()=>a(!0)))},[e]),e}function c(e,a){if(!e)return{__html:""};let s=String(e);return a&&"undefined"!=typeof window&&window.katex?(s=s.replace(/\$\$([\s\S]+?)\$\$/g,(e,a)=>{try{return window.katex.renderToString(a,{displayMode:!0,throwOnError:!1})}catch(a){return e}}),s=s.replace(/\\\((.+?)\\\)/g,(e,a)=>{try{return window.katex.renderToString(a,{throwOnError:!1})}catch(a){return e}}),s=s.replace(/(?<!\$)\$(?!\$)(.+?)(?<!\$)\$(?!\$)/g,(e,a)=>{try{return window.katex.renderToString(a,{throwOnError:!1})}catch(a){return e}})):s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>"),{__html:s}}function i(e){return e&&(e.firstName&&String(e.firstName).trim()||e.name&&String(e.name).trim().split(/\s+/)[0]||e.email&&String(e.email).split("@")[0])||""}function o(e){const a=e.slice();for(let e=a.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[a[e],a[s]]=[a[s],a[e]]}return a}},8236:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var t=s(4705),n=s(6540),r=s(1444),l=s(3064),c=s(7791),i=s(9920),o=s(4848);function d(e,a){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),s.push.apply(s,t)}return s}function u(e){for(var a=1;a<arguments.length;a++){var s=null!=arguments[a]?arguments[a]:{};a%2?d(Object(s),!0).forEach(function(a){(0,t.A)(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}function v(e){let{text:a}=e;const s=(0,c.n7)();return a?/\$/.test(a)||/\\\(/.test(a)?(0,o.jsx)("span",{dangerouslySetInnerHTML:(0,c.qZ)(a,s)}):(0,o.jsx)(o.Fragment,{children:a}):null}function h(e){let{stats:a,filters:s,onFilterChange:t,subjects:n,examItems:r}=e;return(0,o.jsxs)("div",{className:"av-filter-bar",children:[(0,o.jsxs)("div",{className:"av-filter-bar__stats",children:[(0,o.jsxs)("span",{className:"av-stat av-stat--verified",children:["‚úì ",a.verified," verified"]}),(0,o.jsxs)("span",{className:"av-stat av-stat--pending",children:["‚óå ",a.pending," pending"]}),(0,o.jsxs)("span",{className:"av-stat av-stat--rejected",children:["‚úó ",a.rejected," rejected"]}),(0,o.jsxs)("span",{className:"av-stat av-stat--total",children:[a.total," total"]})]}),(0,o.jsxs)("div",{className:"av-filter-bar__controls",children:[(0,o.jsxs)("select",{className:"av-select",value:s.status,onChange:e=>t(u(u({},s),{},{status:e.target.value})),children:[(0,o.jsx)("option",{value:"pending",children:"Pending review"}),(0,o.jsx)("option",{value:"verified",children:"Verified ‚úì"}),(0,o.jsx)("option",{value:"rejected",children:"Rejected ‚úó"}),(0,o.jsx)("option",{value:"all",children:"All questions"})]}),(0,o.jsxs)("select",{className:"av-select",value:s.subject,onChange:e=>t(u(u({},s),{},{subject:e.target.value})),children:[(0,o.jsx)("option",{value:"",children:"All subjects"}),n.map(e=>(0,o.jsx)("option",{value:e,children:e},e))]}),(0,o.jsxs)("select",{className:"av-select",value:s.type,onChange:e=>t(u(u({},s),{},{type:e.target.value})),children:[(0,o.jsx)("option",{value:"",children:"All types"}),(0,o.jsx)("option",{value:"proof",children:"Proof / D√©monstration"}),(0,o.jsx)("option",{value:"calculation",children:"Calculation"}),(0,o.jsx)("option",{value:"fill_blank",children:"Fill in blank"}),(0,o.jsx)("option",{value:"short_answer",children:"Short answer"}),(0,o.jsx)("option",{value:"essay",children:"Essay / Long answer"})]})]})]})}function p(e){let{part:a,partIndex:s,onChange:t}=e;const[r,l]=(0,n.useState)(!1),[c,i]=(0,n.useState)(a.answer||""),[d,h]=(0,n.useState)((a.alternatives||[]).join("\n"));return(0,n.useEffect)(()=>{i(a.answer||""),h((a.alternatives||[]).join("\n"))},[a]),(0,o.jsxs)("div",{className:"av-part ".concat(r?"av-part--editing":""),children:[(0,o.jsxs)("div",{className:"av-part__header",children:[(0,o.jsx)("span",{className:"av-part__label",children:a.label||"Part ".concat(s+1)}),!r&&(0,o.jsx)("button",{className:"av-btn av-btn--sm av-btn--ghost",onClick:()=>l(!0),children:"‚úèÔ∏è Edit"})]}),r?(0,o.jsxs)("div",{className:"av-part__edit-form",children:[(0,o.jsx)("label",{className:"av-label",children:"Primary answer"}),(0,o.jsx)("input",{className:"av-input",value:c,onChange:e=>i(e.target.value),placeholder:"Correct answer"}),(0,o.jsx)("label",{className:"av-label",style:{marginTop:"0.5rem"},children:"Alternatives (one per line)"}),(0,o.jsx)("textarea",{className:"av-textarea",value:d,onChange:e=>h(e.target.value),placeholder:"Alternative accepted answers, one per line",rows:Math.max(3,(a.alternatives||[]).length+1)}),(0,o.jsxs)("div",{className:"av-part__edit-actions",children:[(0,o.jsx)("button",{className:"av-btn av-btn--sm av-btn--primary",onClick:()=>{const e=d.split("\n").map(e=>e.trim()).filter(Boolean);t(s,u(u({},a),{},{answer:c.trim(),alternatives:e})),l(!1)},children:"Save"}),(0,o.jsx)("button",{className:"av-btn av-btn--sm av-btn--ghost",onClick:()=>{i(a.answer||""),h((a.alternatives||[]).join("\n")),l(!1)},children:"Cancel"})]})]}):(0,o.jsxs)("div",{className:"av-part__display",children:[(0,o.jsxs)("div",{className:"av-part__answer",children:[(0,o.jsx)("strong",{children:"Answer:"})," ",(0,o.jsx)(v,{text:a.answer})]}),a.alternatives&&a.alternatives.length>0&&(0,o.jsxs)("div",{className:"av-part__alts",children:[(0,o.jsx)("span",{className:"av-part__alts-label",children:"Also accepts:"}),a.alternatives.map((e,a)=>(0,o.jsx)("span",{className:"av-part__alt-chip",children:(0,o.jsx)(v,{text:e})},a))]})]})]})}function m(e){let{approaches:a}=e;const[s,t]=(0,n.useState)(null);return a&&0!==a.length?(0,o.jsxs)("div",{className:"av-approaches",children:[(0,o.jsxs)("h4",{className:"av-approaches__title",children:["Solution Approaches (",a.length,")"]}),a.map((e,a)=>(0,o.jsxs)("div",{className:"av-approach",children:[(0,o.jsxs)("button",{className:"av-approach__toggle",onClick:()=>t(s===a?null:a),children:[(0,o.jsxs)("span",{className:"av-approach__name",children:[s===a?"‚ñæ":"‚ñ∏"," ",e.name||"Approach ".concat(a+1)]}),(0,o.jsxs)("span",{className:"av-approach__step-count",children:[(e.steps||[]).length," steps"]})]}),s===a&&(0,o.jsx)("ol",{className:"av-approach__steps",children:(e.steps||[]).map((e,a)=>(0,o.jsx)("li",{className:"av-approach__step",children:(0,o.jsx)(v,{text:e})},a))})]},a))]}):null}function x(e){var a,s;let{item:t,onAction:r,currentIndex:l,totalFiltered:c}=e;const d=t.question,u=t.exam,h=t.section,x=(0,i.c$)(u.subject||""),j=(0,i.cS)(x),g=i.ap[d.type]||{icon:"‚ùì",label:d.type},[f,_]=(0,n.useState)(null),[b,N]=(0,n.useState)(null),[w,y]=(0,n.useState)(!1);(0,n.useEffect)(()=>{_(null),N(null),y(!1)},[t.id]);const k=f||d.answer_parts||[],S=null!==b?b:d.final_answer||"",C=null!==f||null!==b,q=(e,a)=>{const s=[...k];s[e]=a,_(s)};return(0,o.jsxs)("div",{className:"av-card",children:[(0,o.jsxs)("div",{className:"av-card__header",children:[(0,o.jsxs)("div",{className:"av-card__meta",children:[(0,o.jsx)("span",{className:"av-card__badge",style:{backgroundColor:j+"22",color:j,borderColor:j+"44"},children:x}),(0,o.jsxs)("span",{className:"av-card__type",children:[g.icon," ",g.label]}),(0,o.jsxs)("span",{className:"av-card__exam-title",title:u.title,children:[null===(a=u.title)||void 0===a?void 0:a.substring(0,60),(null===(s=u.title)||void 0===s?void 0:s.length)>60?"‚Ä¶":""]})]}),(0,o.jsxs)("div",{className:"av-card__nav-info",children:[l+1," / ",c]})]}),(null==h?void 0:h.instructions)&&(0,o.jsxs)("div",{className:"av-card__context",children:[(0,o.jsx)("strong",{children:"Section:"})," ",h.title||"Untitled",(0,o.jsxs)("details",{className:"av-card__instructions",children:[(0,o.jsx)("summary",{children:"Section instructions"}),(0,o.jsx)(v,{text:h.instructions})]})]}),t.parentQuestion&&(0,o.jsxs)("div",{className:"av-card__parent",children:[(0,o.jsx)("span",{className:"av-card__parent-label",children:"Parent question:"}),(0,o.jsx)(v,{text:t.parentQuestion.question})]}),(0,o.jsxs)("div",{className:"av-card__question",children:[(0,o.jsx)("h3",{className:"av-card__question-text",children:(0,o.jsx)(v,{text:d.question||d.text||"(no question text)"})}),d.figure_description&&(0,o.jsxs)("div",{className:"av-card__figure",children:[(0,o.jsx)("span",{className:"av-card__figure-label",children:"üìä Figure:"}),(0,o.jsx)("span",{className:"av-card__figure-text",children:d.figure_description.substring(0,200)})]})]}),(0,o.jsxs)("div",{className:"av-card__model-answer",children:[(0,o.jsxs)("button",{className:"av-btn av-btn--ghost",onClick:()=>y(!w),children:[w?"‚ñæ Hide":"‚ñ∏ Show"," full model answer"]}),w&&(0,o.jsx)("div",{className:"av-card__model-answer-text",children:(0,o.jsx)(v,{text:d.model_answer})})]}),(0,o.jsx)(m,{approaches:d.approaches}),k.length>0&&(0,o.jsxs)("div",{className:"av-card__parts",children:[(0,o.jsxs)("h4",{className:"av-card__parts-title",children:["Graded Answer Parts (",k.length," blank",1!==k.length?"s":"",")"]}),k.map((e,a)=>(0,o.jsx)(p,{part:e,partIndex:a,onChange:q},a))]}),(d.final_answer||null!==b)&&(0,o.jsxs)("div",{className:"av-card__final-answer",children:[(0,o.jsx)("label",{className:"av-label",children:"Final Answer"}),(0,o.jsx)("div",{className:"av-card__final-answer-row",children:(0,o.jsx)("input",{className:"av-input",value:S,onChange:e=>N(e.target.value),placeholder:"Final answer"})})]}),d.scaffold_text&&(0,o.jsxs)("details",{className:"av-card__scaffold-preview",children:[(0,o.jsx)("summary",{children:"Preview scaffold (student view)"}),(0,o.jsx)("div",{className:"av-card__scaffold-text",children:(0,o.jsx)(v,{text:d.scaffold_text.replace(/\{\{(\d+)\}\}/g,(e,a)=>{const s=k[parseInt(a,10)];return s?"[___".concat(s.label?" "+s.label:"","___]"):"[___]"})})})]}),(0,o.jsxs)("div",{className:"av-card__actions",children:[(0,o.jsxs)("button",{className:"av-btn av-btn--success av-btn--lg",onClick:()=>{r("approve",{answer_parts:C?k:void 0,final_answer:null!==b?b:void 0})},title:"Mark as verified (correct)",children:["‚úì ",C?"Save & Approve":"Approve"]}),(0,o.jsx)("button",{className:"av-btn av-btn--danger av-btn--lg",onClick:()=>{r("reject",{})},title:"Mark as rejected (needs regeneration)",children:"‚úó Reject"})]}),C&&(0,o.jsx)("div",{className:"av-card__edit-notice",children:'‚ö†Ô∏è You have unsaved edits. Click "Save & Approve" to apply changes.'})]})}function j(){const e=(0,l.jE)(),{data:a,isLoading:s,error:t}=(0,r.I)({queryKey:["exam-catalog"],queryFn:async()=>{const e=await fetch("/exam_catalog.json");if(!e.ok)throw new Error("Failed to load exam catalog");return e.json()},staleTime:1/0}),[c,d]=(0,n.useState)(null);(0,n.useEffect)(()=>{a&&!c&&d(JSON.parse(JSON.stringify(a)))},[a,c]);const[u,v]=(0,n.useState)({status:"pending",subject:"",type:""}),[p,m]=(0,n.useState)(0),[j,g]=(0,n.useState)(!1),[f,_]=(0,n.useState)(null),b=(0,n.useRef)(0),N=(0,n.useMemo)(()=>function(e){const a=[];return e?(e.forEach((e,s)=>{(e.sections||[]).forEach((t,n)=>{(t.questions||[]).forEach((r,l)=>{r.model_answer&&a.push({examIdx:s,secIdx:n,qIdx:l,subIdx:null,exam:e,section:t,question:r,id:"".concat(s,"-").concat(n,"-").concat(l)}),(r.sub_questions||[]).forEach((c,i)=>{c.model_answer&&a.push({examIdx:s,secIdx:n,qIdx:l,subIdx:i,exam:e,section:t,question:c,parentQuestion:r,id:"".concat(s,"-").concat(n,"-").concat(l,"-").concat(i)})})})})}),a):a}(c),[c]),w=(0,n.useMemo)(()=>{const e=new Set;for(const a of N){const s=(0,i.c$)(a.exam.subject||"");s&&e.add(s)}return[...e].sort()},[N]),y=(0,n.useMemo)(()=>N.filter(e=>!("pending"===u.status&&e.question.verified||"verified"===u.status&&!0!==e.question.verified||"rejected"===u.status&&"rejected"!==e.question.verified||u.subject&&(0,i.c$)(e.exam.subject||"")!==u.subject||u.type&&e.question.type!==u.type)),[N,u]),k=(0,n.useMemo)(()=>function(e){let a=0,s=0,t=0;for(const n of e)!0===n.question.verified?a++:"rejected"===n.question.verified?s++:t++;return{total:e.length,verified:a,rejected:s,pending:t}}(N),[N]);(0,n.useEffect)(()=>{p>=y.length&&y.length>0&&m(y.length-1)},[y,p]);const S=y[p]||null,C=(0,n.useCallback)(()=>{p<y.length-1&&m(e=>e+1)},[p,y.length]),q=(0,n.useCallback)(()=>{p>0&&m(e=>e-1)},[p]);(0,n.useEffect)(()=>{function e(e){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&("ArrowRight"!==e.key&&"j"!==e.key||C(),"ArrowLeft"!==e.key&&"k"!==e.key||q())}return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[C,q]);const A=(0,n.useCallback)((e,a)=>{if(!S||!c)return;const{examIdx:s,secIdx:t,qIdx:n,subIdx:r}=S,l=[...c],i=null!==r?l[s].sections[t].questions[n].sub_questions[r]:l[s].sections[t].questions[n];"approve"===e?(i.verified=!0,a.answer_parts&&(i.answer_parts=a.answer_parts),void 0!==a.final_answer&&(i.final_answer=a.final_answer),a.answer_parts&&i.scaffold_text):"reject"===e&&(i.verified="rejected"),d(l),b.current++,"pending"===u.status?m(e=>Math.min(e,Math.max(0,y.length-2))):C()},[S,c,u.status,y.length,C]),E=(0,n.useCallback)(async()=>{if(c){g(!0),_(null);try{const a=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),t=document.createElement("a");t.href=s,t.download="exam_catalog.json",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s),b.current=0,_("success"),e.setQueryData(["exam-catalog"],c)}catch(e){console.error("Save failed:",e),_("error")}finally{g(!1)}}},[c,e]);return s?(0,o.jsxs)("div",{className:"container av-page",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{className:"text-muted",style:{textAlign:"center"},children:"Loading exam catalog‚Ä¶"})]}):t?(0,o.jsx)("div",{className:"container av-page",children:(0,o.jsxs)("div",{className:"card",style:{textAlign:"center",padding:"3rem"},children:[(0,o.jsx)("h2",{children:"Failed to load catalog"}),(0,o.jsx)("p",{className:"text-muted",children:t.message})]})}):(0,o.jsxs)("div",{className:"container av-page",children:[(0,o.jsxs)("div",{className:"av-header",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:"page-header__eyebrow",children:"Admin"}),(0,o.jsx)("h1",{children:"Answer Verification"}),(0,o.jsx)("p",{className:"text-muted",children:"Review and approve AI-generated answers for exam questions"})]}),(0,o.jsxs)("div",{className:"av-header__actions",children:[(0,o.jsx)("button",{className:"av-btn av-btn--primary ".concat(j?"av-btn--loading":""),onClick:E,disabled:j||0===b.current,children:j?"Saving‚Ä¶":"üíæ Save Catalog (".concat(b.current," changes)")}),"success"===f&&(0,o.jsx)("span",{className:"av-save-status av-save-status--success",children:"‚úì Downloaded! Replace public/exam_catalog.json with the downloaded file."}),"error"===f&&(0,o.jsx)("span",{className:"av-save-status av-save-status--error",children:"‚úó Save failed"})]})]}),(0,o.jsxs)("div",{className:"av-progress-bar",children:[(0,o.jsx)("div",{className:"av-progress-bar__fill",style:{width:"".concat(k.total?k.verified/k.total*100:0,"%")}}),(0,o.jsxs)("span",{className:"av-progress-bar__label",children:[k.verified," / ",k.total," verified (",k.total?Math.round(k.verified/k.total*100):0,"%)"]})]}),(0,o.jsx)(h,{stats:k,filters:u,onFilterChange:e=>{v(e),m(0)},subjects:w,examItems:N}),(0,o.jsxs)("div",{className:"av-nav",children:[(0,o.jsx)("button",{className:"av-btn av-btn--ghost",onClick:q,disabled:p<=0,children:"‚Üê Prev"}),(0,o.jsx)("span",{className:"av-nav__position",children:y.length>0?"Question ".concat(p+1," of ").concat(y.length):"No questions match filters"}),(0,o.jsx)("button",{className:"av-btn av-btn--ghost",onClick:C,disabled:p>=y.length-1,children:"Next ‚Üí"})]}),S?(0,o.jsx)(x,{item:S,onAction:A,currentIndex:p,totalFiltered:y.length},S.id):(0,o.jsxs)("div",{className:"av-empty",children:[(0,o.jsx)("div",{className:"av-empty__icon",children:"üéâ"}),(0,o.jsx)("h3",{children:"All caught up!"}),(0,o.jsx)("p",{className:"text-muted",children:"pending"===u.status?"No more questions pending review with the current filters.":"No questions match the current filters."}),0===k.pending&&k.total>0&&(0,o.jsxs)("p",{className:"text-muted",children:["All ",k.total," answers have been reviewed."]})]}),(0,o.jsx)("div",{className:"av-shortcuts",children:(0,o.jsxs)("span",{children:["Keyboard: ",(0,o.jsx)("kbd",{children:"‚Üê"})," / ",(0,o.jsx)("kbd",{children:"k"})," prev ¬∑ ",(0,o.jsx)("kbd",{children:"‚Üí"})," / ",(0,o.jsx)("kbd",{children:"j"})," next"]})})]})}}}]);