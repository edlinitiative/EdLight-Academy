import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

const resources = {
  en: {
    translation: {
      common: {
        loading: 'Loading...',
        error: 'An error occurred',
        close: 'Close',
        pointsShort: 'pts',
        save: 'Save',
        cancel: 'Cancel',
        delete: 'Delete',
        edit: 'Edit',
        next: 'Next',
        previous: 'Previous',
        search: 'Search',
        all: 'All',
        none: 'None',
        required: 'Required'
      },
      auth: {
        signIn: 'Sign In',
        signUp: 'Sign Up',
        signOut: 'Sign Out',
        email: 'Email',
        password: 'Password',
        fullName: 'Full Name',
        forgotPassword: 'Forgot Password?',
        noAccount: "Don't have an account?",
        hasAccount: 'Already have an account?'
      },
      courses: {
        catalog: 'Course Catalog',
        catalogTitle: 'Explore the EdLight Academy Curriculum',
        catalogSubtitle: 'Filter by level or return to the lessons you already started.',
        myCourses: 'My Courses',
        start: 'Start',
        startCourse: 'Start',
        continue: 'Continue',
        preview: 'Preview',
        details: 'Details',
        enroll: 'Enroll',
        enrolled: 'Enrolled',
        viewDashboard: 'View Dashboard',
        resetFilters: 'Reset Filters',
        noCoursesTitle: 'No courses match this filter yet',
        noCoursesSubtitle: 'Adjust the filters or head back to the full catalog.',
        progress: 'Progress',
        progressPercent: '{{percent}}% complete',
        completed: 'Completed',
        modules: 'Modules',
        modulesCount_one: '{{count}} module',
        modulesCount_other: '{{count}} modules',
        duration: 'Duration',
        selfPaced: 'Self-paced',
        instructor: 'Instructor',
        taughtBy: 'Taught by',
        students: 'Students',
        rating: 'Rating',
        courseContent: 'Course Content',
        lessonsCount_one: '{{count}} lesson',
        lessonsCount_other: '{{count}} lessons',
        lessons: 'Lessons',
        aboutThisCourse: 'About This Course',
        syllabus: 'Course Syllabus',
        continueLearning: 'Continue Learning',
        closeSidebar: 'Close sidebar',
        lessonsCompletedProgress: '{{completed}} of {{total}} lessons completed',
        sidebarEmpty: 'Modules for this course will appear here shortly.',
        notAvailableTitle: 'This course is not available',
        notAvailableBody: "We couldn't find the course you were looking for.",
        returnToCatalog: 'Return to Course List',
        videoPlaceholder: 'Video content will appear here once available.',
        markComplete: 'Mark Complete',
        dayStreak: 'day streak',
        completedLower: 'completed',
        flashcards: 'Flashcards',
        flashcardsTitle: 'Study with flashcards',
        practice: 'Practice',
        practiceTitle: 'Practice with quiz',
        discussionComments: 'Discussion & Comments',
        chapter: 'Chapter',
        guidedPathCaption: 'Guided path with quizzes and mastery checks'
      },
      quizzes: {
        start: 'Start Quiz',
        check: 'Check Answer',
        correct: 'Correct!',
        incorrect: 'Incorrect, try again',
        hint: 'Hint',
        explanation: 'Explanation',
        tryAgain: 'Try Again',
        submit: 'Submit',
        score: 'Score',
        curriculumPractice: 'Curriculum Practice',
        practiceHub: 'Practice Hub',
        subtitle: 'Choose your course, grade, and unit to practice with targeted questions. Get up to three tries with helpful hints.',
        selectArea: 'Select Practice Area',
        course: 'Course',
        gradeLevel: 'Grade Level',
        unit: 'Unit',
        selectToBegin: 'Select a course, grade, and unit to begin.',
        noPractice: 'No curriculum practice available for this selection yet.',
        unableToLoad: 'Unable to load curriculum practice right now.',
        questionsAvailable_one: '{{count}} question available',
        questionsAvailable_other: '{{count}} questions available',
        startPractice: 'Start Practice',
        nextQuestion: 'Next Question',
        howItWorks: 'How It Works',
        howItWorksTry: 'Three tries per question',
        howItWorksHints: 'Progressive hints after each incorrect answer',
        howItWorksExplain: 'Full explanation revealed after third try',
        ready: 'Ready to Practice?',
        readyBody: 'Select a course, grade, and unit, then click "Start Practice" to begin.',
        triesLeft_one: '{{count}} try left',
        triesLeft_other: '{{count}} tries left',
        outOfTries: 'Out of tries',
        correctChip: 'Correct',
        context: 'Context',
        writeAnswerHere: 'Write your answer here…',
        wordCount_one: '{{count}} word',
        wordCount_other: '{{count}} words',
        answered: 'Answered',
        answerLabel: 'Answer',
        correctAnswerLabel: 'Correct answer',
        unitQuiz: 'Unit Quiz',
        unitQuizSelect: 'Choose a course and unit to start a 10-question quiz.',
        results: 'Results',
        scoreOutOf: 'You scored {{score}} out of {{total}}.',
        retry: 'Retry Quiz',
        noQuestions: 'No questions available for this chapter yet.',
        questionN: 'Question {{n}}',
        finish: 'Finish'
      },
      subjects: {
        CHEM: 'Chemistry',
        PHYS: 'Physics',
        MATH: 'Mathematics',
        ECON: 'Economics'
      }
    }
  },
  fr: {
    translation: {
      common: {
        loading: 'Chargement…',
        error: 'Une erreur est survenue',
        close: 'Fermer',
        pointsShort: 'pts',
        save: 'Enregistrer',
        cancel: 'Annuler',
        delete: 'Supprimer',
        edit: 'Modifier',
        next: 'Suivant',
        previous: 'Précédent',
        search: 'Rechercher',
        all: 'Tout',
        none: 'Aucun',
        required: 'Obligatoire'
      },
      auth: {
        signIn: 'Se connecter',
        signUp: "S’inscrire",
        signOut: 'Se déconnecter',
        email: 'Email',
        password: 'Mot de passe',
        fullName: 'Nom complet',
        forgotPassword: 'Mot de passe oublié ?',
        noAccount: "Pas de compte ?",
        hasAccount: 'Déjà un compte ?'
      },
      courses: {
        catalog: 'Catalogue des cours',
        catalogTitle: 'Explorez le programme EdLight Academy',
        catalogSubtitle: 'Filtrez par niveau ou reprenez les leçons que vous avez déjà commencées.',
        myCourses: 'Mes cours',
        start: 'Commencer',
        startCourse: 'Commencer',
        continue: 'Continuer',
        preview: 'Aperçu',
        details: 'Détails',
        enroll: "S’inscrire",
        enrolled: 'Inscrit',
        viewDashboard: 'Voir le tableau de bord',
        resetFilters: 'Réinitialiser les filtres',
        noCoursesTitle: "Aucun cours ne correspond à ce filtre pour l’instant",
        noCoursesSubtitle: 'Ajustez les filtres ou revenez au catalogue complet.',
        progress: 'Progression',
        progressPercent: '{{percent}}% terminé',
        completed: 'Terminé',
        modules: 'Modules',
        modulesCount_one: '{{count}} module',
        modulesCount_other: '{{count}} modules',
        duration: 'Durée',
        selfPaced: 'À votre rythme',
        instructor: 'Enseignant',
        taughtBy: 'Enseigné par',
        students: 'Élèves',
        rating: 'Note',
        courseContent: 'Contenu du cours',
        lessonsCount_one: '{{count}} leçon',
        lessonsCount_other: '{{count}} leçons',
        lessons: 'Leçons',
        aboutThisCourse: 'À propos de ce cours',
        syllabus: 'Plan du cours',
        continueLearning: 'Continuer',
        closeSidebar: 'Fermer le menu',
        lessonsCompletedProgress: '{{completed}} sur {{total}} leçons terminées',
        sidebarEmpty: 'Les modules de ce cours apparaîtront ici bientôt.',
        notAvailableTitle: "Ce cours n'est pas disponible",
        notAvailableBody: "Nous n'avons pas trouvé le cours que vous cherchez.",
        returnToCatalog: 'Retour au catalogue',
        videoPlaceholder: "Le contenu vidéo apparaîtra ici dès qu'il sera disponible.",
        markComplete: 'Marquer comme terminé',
        dayStreak: 'jours de série',
        completedLower: 'terminés',
        flashcards: 'Flashcards',
        flashcardsTitle: 'Étudier avec des flashcards',
        practice: 'Exercices',
        practiceTitle: "S'entraîner avec un quiz",
        discussionComments: 'Discussion & commentaires',
        chapter: 'Chapitre',
        guidedPathCaption: 'Parcours guidé avec quiz et suivi de maîtrise'
      },
      quizzes: {
        start: 'Démarrer le quiz',
        check: 'Vérifier',
        correct: 'Correct !',
        incorrect: 'Incorrect, réessaie',
        hint: 'Indice',
        explanation: 'Explication',
        tryAgain: 'Réessayer',
        submit: 'Envoyer',
        score: 'Score',
        curriculumPractice: 'Exercices du programme',
        practiceHub: "Espace d'exercices",
        subtitle: "Choisissez votre cours, niveau et unité pour vous entraîner avec des questions ciblées. Vous avez jusqu'à trois essais avec des indices.",
        selectArea: "Choisir une zone d'exercice",
        course: 'Matière',
        gradeLevel: 'Niveau',
        unit: 'Unité',
        selectToBegin: 'Choisissez un cours, un niveau et une unité pour commencer.',
        noPractice: 'Aucun exercice disponible pour cette sélection pour le moment.',
        unableToLoad: 'Impossible de charger les exercices pour le moment.',
        questionsAvailable_one: '{{count}} question disponible',
        questionsAvailable_other: '{{count}} questions disponibles',
        startPractice: 'Commencer',
        nextQuestion: 'Question suivante',
        howItWorks: 'Comment ça marche',
        howItWorksTry: 'Trois essais par question',
        howItWorksHints: 'Indices progressifs après chaque mauvaise réponse',
        howItWorksExplain: 'Explication complète après le troisième essai',
        ready: "Prêt à vous entraîner ?",
        readyBody: 'Choisissez un cours, un niveau et une unité, puis cliquez sur « Commencer » pour démarrer.',
        triesLeft_one: '{{count}} essai restant',
        triesLeft_other: '{{count}} essais restants',
        outOfTries: "Plus d'essais",
        correctChip: 'Correct',
        context: 'Contexte',
        writeAnswerHere: 'Écrivez votre réponse ici…',
        wordCount_one: '{{count}} mot',
        wordCount_other: '{{count}} mots',
        answered: 'Répondu',
        answerLabel: 'Réponse',
        correctAnswerLabel: 'Bonne réponse',
        unitQuiz: "Quiz de l'unité",
        unitQuizSelect: "Choisissez un cours et une unité pour démarrer un quiz de 10 questions.",
        results: 'Résultats',
        scoreOutOf: 'Votre score : {{score}} sur {{total}}.',
        retry: 'Recommencer',
        noQuestions: 'Aucune question disponible pour ce chapitre pour le moment.',
        questionN: 'Question {{n}}',
        finish: 'Terminer'
      },
      subjects: {
        CHEM: 'Chimie',
        PHYS: 'Physique',
        MATH: 'Mathématiques',
        ECON: 'Économie'
      }
    }
  },
  ht: {
    translation: {
      common: {
        loading: 'Ap chaje…',
        error: 'Gen yon erè ki rive',
        close: 'Fèmen',
        pointsShort: 'pts',
        save: 'Sove',
        cancel: 'Anile',
        delete: 'Efase',
        edit: 'Modifye',
        next: 'Pwochen',
        previous: 'Anvan',
        search: 'Chèche',
        all: 'Tout',
        none: 'Okenn',
        required: 'Obligatwa'
      },
      auth: {
        signIn: 'Konekte',
        signUp: 'Enskri',
        signOut: 'Dekonekte',
        email: 'Imèl',
        password: 'Modpas',
        fullName: 'Non konplè',
        forgotPassword: 'Ou bliye modpas la?',
        noAccount: 'Ou pa gen kont?',
        hasAccount: 'Ou deja gen kont?'
      },
      courses: {
        catalog: 'Katalòg kou yo',
        catalogTitle: 'Dekouvri pwogram EdLight Academy',
        catalogSubtitle: 'Filtre pa nivo oswa retounen sou leson ou te deja kòmanse yo.',
        myCourses: 'Kou mwen yo',
        start: 'Kòmanse',
        startCourse: 'Kòmanse',
        continue: 'Kontinye',
        preview: 'Gade yon ti apèsi',
        details: 'Detay',
        enroll: 'Enskri',
        enrolled: 'Ou enskri',
        viewDashboard: 'Gade tablodbò a',
        resetFilters: 'Reyinisyalize filtè yo',
        noCoursesTitle: 'Pa gen kou ki mache ak filtè sa a',
        noCoursesSubtitle: 'Chanje filtè yo oswa retounen nan tout katalòg la.',
        progress: 'Pwogrè',
        progressPercent: '{{percent}}% fini',
        completed: 'Fini',
        modules: 'Modil',
        modulesCount_one: '{{count}} modil',
        modulesCount_other: '{{count}} modil',
        duration: 'Dire',
        selfPaced: 'Ale nan pwòp vitès ou',
        instructor: 'Pwofesè',
        taughtBy: 'Pwofesè a',
        students: 'Elèv',
        rating: 'Nòt',
        courseContent: 'Sa ki nan kou a',
        lessonsCount_one: '{{count}} leson',
        lessonsCount_other: '{{count}} leson',
        lessons: 'Leson',
        aboutThisCourse: 'Sou kou sa a',
        syllabus: 'Plan kou a',
        continueLearning: 'Kontinye',
        closeSidebar: 'Fèmen meni a',
        lessonsCompletedProgress: '{{completed}} sou {{total}} leson fini',
        sidebarEmpty: 'Modil pou kou sa a ap parèt isit la byento.',
        notAvailableTitle: 'Kou sa a pa disponib',
        notAvailableBody: 'Nou pa jwenn kou w ap chèche a.',
        returnToCatalog: 'Retounen nan lis kou yo',
        videoPlaceholder: 'Kontni videyo a ap parèt isit la lè li disponib.',
        markComplete: 'Make li fini',
        dayStreak: 'jou an seri',
        completedLower: 'fini',
        flashcards: 'Flashcards',
        flashcardsTitle: 'Etidye ak flashcards',
        practice: 'Pratike',
        practiceTitle: 'Pratike ak quiz',
        discussionComments: 'Diskisyon & kòmantè',
        chapter: 'Chapit',
        guidedPathCaption: 'Chemen gid ak quiz ak siveyans metrize'
      },
      quizzes: {
        start: 'Kòmanse kesyon yo',
        check: 'Verifye',
        correct: 'Bon!',
        incorrect: 'Pa bon, eseye ankò',
        hint: 'Endis',
        explanation: 'Eksplikasyon',
        tryAgain: 'Esaye ankò',
        submit: 'Voye',
        score: 'Nòt',
        curriculumPractice: 'Pratik nan pwogram nan',
        practiceHub: 'Sant pratik',
        subtitle: 'Chwazi kou w, nivo w, ak inite w pou pratike ak kesyon ki byen chwazi. Ou gen jiska 3 esè ak endis.',
        selectArea: 'Chwazi zòn pratik',
        course: 'Matyè',
        gradeLevel: 'Nivo',
        unit: 'Inite',
        selectToBegin: 'Chwazi yon kou, nivo, ak inite pou kòmanse.',
        noPractice: 'Pa gen pratik pou seleksyon sa a pou kounye a.',
        unableToLoad: 'Nou pa ka chaje pratik la kounye a.',
        questionsAvailable_one: '{{count}} kesyon disponib',
        questionsAvailable_other: '{{count}} kesyon disponib',
        startPractice: 'Kòmanse',
        nextQuestion: 'Pwochen kesyon',
        howItWorks: 'Kijan sa mache',
        howItWorksTry: 'Twa esè pou chak kesyon',
        howItWorksHints: 'Endis ki ogmante chak fwa w reponn mal',
        howItWorksExplain: 'Eksplikasyon konplè apre 3yèm esè a',
        ready: 'Ou pare pou pratike?',
        readyBody: 'Chwazi yon kou, nivo, ak inite, epi klike sou « Kòmanse » pou demare.',
        triesLeft_one: '{{count}} esè rete',
        triesLeft_other: '{{count}} esè rete',
        outOfTries: 'Pa gen esè ankò',
        correctChip: 'Bon',
        context: 'Kontèks',
        writeAnswerHere: 'Ekri repons ou isit la…',
        wordCount_one: '{{count}} mo',
        wordCount_other: '{{count}} mo',
        answered: 'Reponn',
        answerLabel: 'Repons',
        correctAnswerLabel: 'Bon repons',
        unitQuiz: 'Quiz inite a',
        unitQuizSelect: 'Chwazi yon kou ak yon inite pou kòmanse yon quiz 10 kesyon.',
        results: 'Rezilta',
        scoreOutOf: 'Nòt ou: {{score}} sou {{total}}.',
        retry: 'Rekòmanse',
        noQuestions: 'Pa gen kesyon pou chapit sa a pou kounye a.',
        questionN: 'Kesyon {{n}}',
        finish: 'Fini'
      },
      subjects: {
        CHEM: 'Chimi',
        PHYS: 'Fizik',
        MATH: 'Matematik',
        ECON: 'Ekonomi'
      }
    }
  }
};

function getInitialLanguage() {
  // Prefer persisted language from Zustand store.
  try {
    const raw = localStorage.getItem('edlight-storage');
    if (raw) {
      const parsed = JSON.parse(raw);
      const lang = parsed?.state?.language;
      if (lang === 'fr' || lang === 'ht') return lang;
      if (lang === 'en') return 'fr';
    }
  } catch {
    // ignore
  }

  // Next: derive from browser, otherwise default to French.
  const navLang = (typeof navigator !== 'undefined' && (navigator.language || navigator.userLanguage)) || '';
  const normalized = String(navLang).toLowerCase();
  if (normalized.startsWith('ht')) return 'ht';
  if (normalized.startsWith('fr')) return 'fr';
  return 'fr';
}

export function initI18n() {
  i18n
    .use(initReactI18next)
    .init({
      resources,
      lng: getInitialLanguage(),
      supportedLngs: ['fr', 'ht', 'en'],
      fallbackLng: 'fr',
      interpolation: {
        escapeValue: false
      }
    });
}